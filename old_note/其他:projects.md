## TOKO 
### 项目部署架构介绍：

前端:slb 负载均衡, 部了两台, 工程分3个, 分别为 卖家, 买家(vue + node.js 渲染,做搜索优化), 小二端  

后端业务模块:同样也是 slb 负载均衡, 大概为10个节点. 每个节点分别为主备结构,商品,订单用了mycat 分库分表.  

### 使用的中间件技术:
1. redis: 做token校验 & 缓存， 单台redis  
2. es: 商品,报价单  
3. rocketMq: 配合es  
4. caml (流程中间件): 流程每个节点,可以单独复用. 组合到其他的流程中. 达到复用的目的  
   4.1： 将业务流程中的执行节点保存在一个队列中，配置动态路由，路由的逻辑就是一直取出节点，并执行改队列中的节点bean 直到队列中的节点取光为止，流程结束  
5. disconfig： 统一分布式环境下的配置管理，只用了disconfig 的配置托管功能，修改同步更新并未实现; //todo  
6. mycat 常见应用场景，分库分表，读写分离，主从复制    
7. elk: 配合es实现日志的统一搜集及分析 

### 遇到的问题解决 & 优化  

1. 商品录入时粒度比较小，但是拿来卖的时候是以打包的形式来卖的。汽车保养套餐里面就包含机油，车漆等。原本采用的是前端商品，后端商品，并绑定关系的形式来定义商品。很鸡肋，应该有套餐商品的概念，一个套餐商品包含诺干个组成部分，这样更为通用。

2. 创建/更新商品，消息，更新商品的索引部分代码封装的不明朗并存在缺陷：  
   2.1. 原有topic 与处理的监听类通过显式配置的方法配置，即（topic-> list的方式），其实对应关系信息可以放在消息体中。  
   2.2. 消费失败的问题. rocketMq 本身支持send fail 的重试机制，但消费端消费失败的问题如何解决？rocketmq 只记录消费失败的消息列表供消费端查询并重新消费，并不能保证消费端成功消费    
   2.3. 重复消费的问题. rocketMq 支持 集群， 广播两种消费方式，前者只要一个client成功消费就会返回，后者广播消费不支持顺序消费。另外 可以利用 集群模式 实现广播消费 （refer from https://help.aliyun.com/document_detail/43163.html）

3. 项目结构调整：base 层定义为领域功能。 platform 提供多个平台的差异性功能，比如同一个查询商品功能。小二端，买家端，卖家端都需要，但需求有差异。这样platform就需要三套不同的接口。项目除去platform 层，直接调用base 层，减小发布与维护的难度

4. 聊天模块极光sdk并不稳定，采用socket.io 实现买卖家在线交流

5. 

## 固定收益管理平台
1. 记录:   
a. 上行阶段（即审批单上报给外汇交易系统），主要经过 netty-client（离线数据沉淀） --> agent（就是系统针对与外汇交易系统交互的webService 单独服务）--> 外汇交易系统

