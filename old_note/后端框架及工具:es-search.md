基本概念：
index：逻辑概念，类似与命名空间，包含多个shared(分片)
分片是一个功能完整的搜索引擎，它拥有使用一个节点上的所有资源的能力。无论是主分片还是副本分片都是一个独立的搜索引擎单元。主分片的数量是一开始就固定的，副分片数量可以动态增加
mapping：用于描述字段的类型等元信息，包含字段类型，索引方式(not_analyzed，analyzed)影响索引查找的结果。设置mapping可以理解成为字段设置相关属性。

存储结构 参考
存储文档时根据 shard = hash(routing) % number_of_primary_shards 选择分片，routing 参数暂时就认定为es所有操作都会带上的一个参数。 因为hash函数是固定的，故 对于同一个routing 前后不能改变 shard的个数，要不然根据hash函数就找不到文档了

搜索原理
无论是输入的搜索字符串还是被索引的文档，都会应用分析器对字符串做处理，分析器主要将字符串按照规则分割成一个个的单词（也叫token）。文档被分析时会按照 token 建立起倒序索引，示意图
搜索操作分为两类，一类是filter，一类是 query，前者是 “是否” 绝对的判断条件，后者是基于评分的筛选条件。基于这两类又衍生出很多的 查询谓语(对应java api 中各种的queryBuilder).

默认的查询过程分为两步，第一步协调节点先请求各个分片(副本)获取document id，第二部才真正获取文档内容。每个分片获取到查询请求时，都会本地构建一个 from + page 长的队列 。 所以这种情况下的分页操作是有限制的。

搜索api
搜索主要分为 结构化搜索和全文搜索。 所谓结构化搜索，即同sql ，搜索的字段类型是明确的。其中item，range，等是针对于结构化查询。 match 针对与全文搜索。 bool 查询为组合查询，可组合包含结构化查询和全文搜索的各种查询子句（即各种queryBuilder）